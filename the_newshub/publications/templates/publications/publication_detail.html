{% extends "base.html" %}
{% block title %}{{ publication.name }} | The Newshub{% endblock %}

{% block content %}
    <div class="publication-detail">
        <div class="card mb-4 shadow-sm border-0 p-4">
            <h1 class="mb-3 content-header">{{ publication.name }}</h1>
            <p class="lead">{{ publication.description }}</p>
            <p class="text-muted mb-0">
                Editor{% if publication.editors.count > 1 %}s{% endif %}:
                {% for editor in publication.editors.all %}
                    {{ editor.full_name }}{% if not forloop.last %}, {% endif %}
                {% empty %}
                    <em>None assigned</em>
                {% endfor %}
            </p>
        </div>
        {% if user.is_authenticated and user.role == "reader" %}
            {% if is_subscribed %}
                <form method="post" action="{% url 'unsubscribe_publication' publication.id %}">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-outline-danger btn-sm mt-2">
                        Unsubscribe
                    </button>
                </form>
            {% else %}
                <form method="post" action="{% url 'subscribe_publication' publication.id %}">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-outline-primary btn-sm mt-2">
                        Subscribe
                    </button>
                </form>
            {% endif %}
        {% endif %}

        <h2 class="h4 mb-3 mt-5">Articles from {{ publication.name }}</h2>
        {% if articles %}
            {% for article in articles %}
                <div class="article-card mb-4 p-3 shadow-sm bg-white rounded">
                    <h3 class="h5 mb-1">
                        <a href="{% url 'article_detail' slug=article.slug %}" class="text-decoration-none text-dark">
                            {{ article.title }}
                        </a>
                    </h3>
                    <p class="text-muted mb-1">
                        By {{ article.author.full_name }}
                        Â· Published {{ article.published_at|date:"j M Y, H:i" }}
                    </p>
                </div>
            {% endfor %}
        {% else %}
            <p class="text-muted">No articles have been published by this publication yet.</p>
        {% endif %}
    </div>
{% endblock %}